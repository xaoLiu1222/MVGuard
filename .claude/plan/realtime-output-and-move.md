# MVGuard 功能增强实施规划文档

## 1. 目标定义

### 1.1 需求概述
| 需求编号 | 需求描述 | 优先级 |
|---------|---------|-------|
| REQ-01 | 每审查完一个视频后在UI界面实时输出审查结果 | 高 |
| REQ-02 | 将审查通过的MV移动到指定目录 | 高 |

### 1.2 现状分析

**当前实现问题：**

1. **批量处理无实时反馈**：`process_videos` 函数使用 `for` 循环处理所有视频，全部完成后才一次性返回结果给 UI

2. **文件移动逻辑相反**：当前代码移动的是**不合规**文件，而需求是移动**合规**（通过审查）的文件

### 1.3 目标状态

- 用户点击"开始检测"后，每完成一个视频的检测，UI 立即显示该视频的结果
- 合规的 MV 文件自动移动到用户指定的目录
- 保持现有的报告生成功能

---

## 2. 功能分解

### 2.1 REQ-01: 实时输出审查结果

**技术方案：使用 Gradio 的 Generator（yield）机制**

将 `process_videos` 函数改为 generator 函数，每处理完一个视频就 `yield` 当前累积结果。

### 2.2 REQ-02: 移动合规文件

**技术方案：修改文件移动逻辑**

- 修改 UI 标签：将"不合规文件移动目录"改为"合规文件移动目录"
- 修改判断条件：从 `status == "不合规"` 改为 `status == "合规"`

---

## 3. 实施步骤

### 步骤 1: 修改 UI 标签（app.py）

将"不合规文件移动目录"改为"合规文件移动目录"

### 步骤 2: 将 process_videos 改为 generator 函数（app.py）

1. 移除 `progress=gr.Progress()` 参数
2. 将函数改为 generator，每处理完一个视频 `yield` 一次
3. 修改文件移动条件为合规文件
4. 累积结果并逐步输出

### 步骤 3: 验证 UI 绑定

Gradio 会自动识别 generator 函数并启用流式输出，无需额外配置

---

## 4. 验收标准

| 测试项 | 验收标准 |
|-------|---------|
| 实时输出 | 每完成一个视频检测，UI 立即更新显示结果 |
| 进度显示 | 摘要区域显示当前进度（如 2/5） |
| 合规文件移动 | 合规视频被移动到指定目录 |
| 移动标记 | 被移动的文件详情显示 "[已移动]" |
| 报告生成 | 检测完成后生成 CSV 报告 |

---

## 5. 关键文件

- `app.py` - 核心修改文件：process_videos 函数和 UI 定义
- `utils/file_utils.py` - 文件移动工具（无需修改）
